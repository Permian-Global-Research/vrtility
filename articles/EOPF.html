<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>EOPF Sentinel-2 Level-2A • vrtility</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="EOPF Sentinel-2 Level-2A">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">vrtility</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/cdse-sentinel-2.html">Copernicus Data Space Ecosystem Sentinel-2</a></li>
    <li><a class="dropdown-item" href="../articles/Digital-Earth-Africa-GeoMAD.html">Digital Earth Africa GeoMAD</a></li>
    <li><a class="dropdown-item" href="../articles/EOPF.html">EOPF Sentinel-2 Level-2A</a></li>
    <li><a class="dropdown-item" href="../articles/HLS.html">Harmonized Landsat Sentinel-2</a></li>
    <li><a class="dropdown-item" href="../articles/OmniCloudMask.html">OmniCloudMask</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Permian-Global-Research/vrtility/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>EOPF Sentinel-2 Level-2A</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Permian-Global-Research/vrtility/blob/main/vignettes/EOPF.Rmd" class="external-link"><code>vignettes/EOPF.Rmd</code></a></small>
      <div class="d-none name"><code>EOPF.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates a modern workflow for processing
Sentinel-2 Level-2A data from the EOPF (Earth Observation Processing
Framework) STAC API.</p>
<p>The Earth Observation data landscape is rapidly evolving, with EOPF
positioning itself as a key component of this transformation. There is a
strong industry movement towards adopting Zarr, a modern cloud-native
data format designed for efficient storage and access of large
multi-dimensional arrays. While the tooling ecosystem around Zarr and
EOPF-Zarr specifically is still maturing, this vignette provides a
practical example of working with these data formats using the
<code>vrtility</code> package.</p>
<p>This vignette also demonstrates contemporary approaches to
cloud-masking and image compositing using <a href="https://github.com/DPIRD-DMA/OmniCloudMask" class="external-link">OmniCloudMask</a> and
the geometric median algorithm, respectively.</p>
<p>This example prioritizes data quality and modern processing methods
over raw speed, demonstrating how to generate analysis-ready data using
contemporary cloud-native workflows.</p>
<p>We also demonstrate a powerful new feature of <code>vrtility</code>:
the ability to create derived bands using
<code><a href="../reference/vrt_derived_block.html">vrt_derived_block()</a></code>. This feature enables you to generate
spectral indices (such as NDVI and EVI) and other derived metrics
directly within the VRT framework. Under the hood, it uses <a href="https://github.com/beltoforion/muparser" class="external-link">muparser</a> expressions
executed through VRT pixel functions, providing efficient computation
without requiring intermediate file storage.</p>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>This workflow requires specific system dependencies that may need
additional setup:</p>
<ol style="list-style-type: decimal">
<li><p><strong>EOPFZARR GDAL Plugin</strong>: You’ll need to build and
install the <a href="https://github.com/EOPF-Sample-Service/GDAL-ZARR-EOPF" class="external-link">EOPFZARR
plugin</a> to read EOPF-Zarr formatted data.</p></li>
<li><p><strong>muparser Support</strong>: Your GDAL installation must
include muparser support for derived band calculations. You can verify
this by running: <code><a href="../reference/gdal_options.html">vrtility::check_muparser()</a></code>.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="query-the-eopf-stac-api">Query the EOPF STAC API<a class="anchor" aria-label="anchor" href="#query-the-eopf-stac-api"></a>
</h2>
<p>This example demonstrates the standard workflow for discovering and
filtering satellite imagery through a STAC (SpatioTemporal Asset
Catalog) API. We’ll query the EOPF STAC collection and apply filters to
obtain the specific datasets we need.</p>
<p>The process involves: 1. Querying the STAC collection for available
imagery 2. Filtering by cloud coverage to ensure data quality 3.
Applying coverage filters to guarantee sufficient spatial overlap</p>
<p>In this example, we’re targeting a bounding box around Copenhagen,
Denmark, and using <code><a href="../reference/stac_utilities.html">stac_coverage_filter()</a></code> to ensure we only
retrieve images with adequate coverage of our area of interest.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://permian-global-research.github.io/vrtility/">vrtility</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu">gdalraster</span><span class="fu">::</span><span class="fu"><a href="https://usdaforestservice.github.io/gdalraster/reference/bbox_from_wkt.html" class="external-link">bbox_from_wkt</a></span><span class="op">(</span></span>
<span>  wkt <span class="op">=</span> <span class="st">"POINT (12.56 55.67)"</span>,</span>
<span>  extend_x <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  extend_y <span class="op">=</span> <span class="fl">0.2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">te</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatial_helpers.html">bbox_to_projected</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span></span>
<span><span class="va">trs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">te</span>, <span class="st">"wkt"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">eopf_s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stac_utilities.html">stac_query</a></span><span class="op">(</span></span>
<span>  bbox <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>  stac_source <span class="op">=</span> <span class="st">"https://stac.core.eopf.eodc.eu/"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2025-05-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2025-07-30"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">eopf_filter</span> <span class="op">&lt;-</span> <span class="fu">rstac</span><span class="fu">::</span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/assets_functions.html" class="external-link">assets_select</a></span><span class="op">(</span></span>
<span>  <span class="va">eopf_s2</span>,</span>
<span>  asset_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B02_10m"</span>, <span class="st">"B03_10m"</span>, <span class="st">"B04_10m"</span>, <span class="st">"B08_10m"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/stac_utilities.html">stac_cloud_filter</a></span><span class="op">(</span>max_cloud_cover <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/stac_utilities.html">stac_coverage_filter</a></span><span class="op">(</span><span class="va">bbox</span>, min_coverage <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="download-and-warp-the-images">Download and warp the images<a class="anchor" aria-label="anchor" href="#download-and-warp-the-images"></a>
</h2>
<p>Here we virtually warp the images and then download them to disk
using multiple processes within an isolated set of mirai daemons. Note
that we call <code><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">mirai::daemons()</a></code> within the
<code><a href="https://rdrr.io/r/base/with.html" class="external-link">with()</a></code> function to ensure that the daemons are properly
cleaned up after use.</p>
<p>Critically, we must specify the <code>driver = "EOPFZARR"</code>
argument in <code><a href="../reference/vrt_collect.html">vrt_collect()</a></code> because GDAL will, by default,
attempt to read the files using the built-in Zarr driver, which does not
fully support the EOPF-Zarr format.</p>
<p>Since we want to continue processing this image set, we use the
<code>recollect = TRUE</code> argument to ensure that a new VRT
collection is returned rather than file paths.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, <span class="op">{</span></span>
<span>  <span class="va">eopf_s2_chgn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vrt_collect.html">vrt_collect</a></span><span class="op">(</span></span>
<span>    <span class="va">eopf_filter</span>,</span>
<span>    vsi_prefix <span class="op">=</span> <span class="st">"/vsicurl/"</span>,</span>
<span>    driver <span class="op">=</span> <span class="st">"EOPFZARR"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/vrt_warp.html">vrt_warp</a></span><span class="op">(</span></span>
<span>      t_srs <span class="op">=</span> <span class="va">trs</span>,</span>
<span>      te <span class="op">=</span> <span class="va">te</span>,</span>
<span>      tr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/vrt_compute.html">vrt_compute</a></span><span class="op">(</span></span>
<span>      outfile <span class="op">=</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_temp.html" class="external-link">file_temp</a></span><span class="op">(</span>ext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span>,</span>
<span>      engine <span class="op">=</span> <span class="st">"gdalraster"</span>,</span>
<span>      recollect <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cloud-masking">Cloud masking<a class="anchor" aria-label="anchor" href="#cloud-masking"></a>
</h2>
<p>Here we generate an OmniCloudMask for each image in the VRT
collection using the red, green, and NIR bands. The cloud mask
identifies pixels affected by clouds, cloud shadows, and other
atmospheric interference. We then apply this mask to filter out
low-quality pixels and compute the results to disk.</p>
<p>Note that we use <code>recollect = TRUE</code> to return a new VRT
collection that references the newly created cloud-masked GeoTIFF files,
allowing us to continue working with the data in a virtualized format
for subsequent processing steps.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eopf_s2_mask</span> <span class="op">&lt;-</span> <span class="va">eopf_s2_chgn</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/vrt_create_mask.html">vrt_create_mask</a></span><span class="op">(</span></span>
<span>    inbands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>red <span class="op">=</span> <span class="fl">3</span>, green <span class="op">=</span> <span class="fl">2</span>, nir <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    maskfun <span class="op">=</span> <span class="fu"><a href="../reference/vrt_create_mask.html">create_omnicloudmask</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/vrt_set_maskfun.html">vrt_set_maskfun</a></span><span class="op">(</span></span>
<span>    mask_band <span class="op">=</span> <span class="st">"omnicloudmask"</span>,</span>
<span>    mask_values <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/vrt_compute.html">vrt_compute</a></span><span class="op">(</span></span>
<span>    outfile <span class="op">=</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_temp.html" class="external-link">file_temp</a></span><span class="op">(</span>ext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span>,</span>
<span>    engine <span class="op">=</span> <span class="st">"warp"</span>,</span>
<span>    recollect <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">eopf_s2_mask</span><span class="op">$</span><span class="va">n_items</span><span class="op">)</span>,</span>
<span>  <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">eopf_s2_mask</span>, item <span class="op">=</span> <span class="va">.x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, na_col <span class="op">=</span> <span class="st">"#ffa928"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/cloud-masking-1.png" width="50%"><img src="figure/cloud-masking-2.png" width="50%"><img src="figure/cloud-masking-3.png" width="50%"><img src="figure/cloud-masking-4.png" width="50%"><img src="figure/cloud-masking-5.png" width="50%"><img src="figure/cloud-masking-6.png" width="50%"></p>
</div>
<div class="section level2">
<h2 id="geometric-median-composite">Geometric median composite<a class="anchor" aria-label="anchor" href="#geometric-median-composite"></a>
</h2>
<p>Here we generate a geometric median composite from the cloud-masked
images using <code><a href="../reference/multiband_reduce.html">multiband_reduce()</a></code> with the
<code><a href="../reference/multiband_reduce.html">geomedian()</a></code> function. The geometric median is a robust
statistical method that effectively reduces noise and preserves spectral
characteristics while minimizing the influence of outliers and residual
cloud contamination.</p>
<p>We use <code><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">mirai::daemons()</a></code> to parallelize the computation
across multiple cores, significantly improving processing speed for this
computationally intensive operation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, <span class="op">{</span></span>
<span>  <span class="va">eopf_s2_median</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multiband_reduce.html">multiband_reduce</a></span><span class="op">(</span></span>
<span>    <span class="va">eopf_s2_mask</span>,</span>
<span>    reduce_fun <span class="op">=</span> <span class="fu"><a href="../reference/multiband_reduce.html">geomedian</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    outfile <span class="op">=</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_temp.html" class="external-link">file_temp</a></span><span class="op">(</span>ext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span>,</span>
<span>    recollect <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">eopf_s2_median</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  na_col <span class="op">=</span> <span class="st">"#ffa928"</span>,</span>
<span>  pal <span class="op">=</span> <span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"YlGnBu"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/geomedian-1.png"></p>
</div>
<div class="section level2">
<h2 id="derived-bands">Derived bands<a class="anchor" aria-label="anchor" href="#derived-bands"></a>
</h2>
<p>Spectral indices are essential tools in remote sensing for extracting
meaningful information from multi-band imagery. Common indices like NDVI
(Normalized Difference Vegetation Index), EVI (Enhanced Vegetation
Index), and others help identify vegetation health, water content, and
other surface characteristics.</p>
<p>The <code>vrtility</code> package provides
<code><a href="../reference/vrt_derived_block.html">vrt_derived_block()</a></code> for efficient creation of these derived
bands. This function uses R’s intuitive formula syntax to define band
calculations, which are then automatically translated to muparser
expressions and executed using VRT pixel functions. This approach
provides memory-efficient computation without requiring intermediate
file storage.</p>
<p>In this example, we’ll calculate several useful indices and visualize
the results:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exptest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vrt_derived_block.html">vrt_derived_block</a></span><span class="op">(</span></span>
<span>  <span class="va">eopf_s2_median</span>,</span>
<span>  <span class="va">ndvi</span> <span class="op">~</span> <span class="op">(</span><span class="va">B08_10m</span> <span class="op">-</span> <span class="va">B04_10m</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">B08_10m</span> <span class="op">+</span> <span class="va">B04_10m</span><span class="op">)</span>,</span>
<span>  <span class="va">ndti</span> <span class="op">~</span> <span class="op">(</span><span class="va">B04_10m</span> <span class="op">-</span> <span class="va">B03_10m</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">B04_10m</span> <span class="op">+</span> <span class="va">B03_10m</span><span class="op">)</span>,</span>
<span>  <span class="va">evi</span> <span class="op">~</span> <span class="fl">2.5</span> <span class="op">*</span> <span class="op">(</span><span class="va">B08_10m</span> <span class="op">-</span> <span class="va">B04_10m</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">B08_10m</span> <span class="op">+</span> <span class="fl">6</span> <span class="op">*</span> <span class="va">B04_10m</span> <span class="op">-</span> <span class="fl">7.5</span> <span class="op">*</span> <span class="va">B02_10m</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="va">vgnirbi</span> <span class="op">~</span> <span class="op">(</span><span class="va">B03_10m</span> <span class="op">-</span> <span class="va">B08_10m</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">B03_10m</span> <span class="op">+</span> <span class="va">B08_10m</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">exptest</span>, pixfun <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; → &lt;VRT Block&gt;</span></span>
<span><span class="co">#&gt; VRT XML: [hidden]</span></span>
<span><span class="co">#&gt;   run print(x, xml = TRUE) to view</span></span>
<span><span class="co">#&gt; Pixel Function:</span></span>
<span><span class="co">#&gt; ndvi ~ ((B08_10m * 0.0001) - (B04_10m * 0.0001))/((B08_10m * 0.0001) + (B04_10m * 0.0001))                                        </span></span>
<span><span class="co">#&gt; ndti ~ ((B04_10m * 0.0001) - (B03_10m * 0.0001))/((B04_10m * 0.0001) + (B03_10m * 0.0001))                                        </span></span>
<span><span class="co">#&gt; evi ~ 2.5 * ((B08_10m * 0.0001) - (B04_10m * 0.0001))/((B08_10m * 0.0001) + 6 * (B04_10m * 0.0001) - 7.5 * (B02_10m * 0.0001) + 1)</span></span>
<span><span class="co">#&gt; vgnirbi ~ ((B03_10m * 0.0001) - (B08_10m * 0.0001))/((B03_10m * 0.0001) + (B08_10m * 0.0001))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  VRT SRS: </span></span>
<span><span class="co">#&gt; PROJCS["unknown",GEOGCS["unknown",DATUM["Unknown based on WGS 84 ellipsoid",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]]],PRIMEM["Greenwich",0],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]]],PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["latitude_of_center",55.67],PARAMETER["longitude_of_center",12.56],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1],AXIS["Easting",EAST],AXIS["Northing",NORTH]]</span></span>
<span><span class="co">#&gt; Bounding Box: -18980 -22270 18980 22310</span></span>
<span><span class="co">#&gt; Pixel res: 10, 10</span></span>
<span><span class="co">#&gt; Assets: ndvi, ndti, evi, vgnirbi</span></span>
<span><span class="co">#&gt; No Data Value(s): 0, 0, 0, 0</span></span>
<span><span class="co">#&gt; Date Time: 2025-06-21 22:21:41 UTC</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vrt_compute.html">vrt_compute</a></span><span class="op">(</span></span>
<span>  <span class="va">exptest</span>,</span>
<span>  outfile <span class="op">=</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_temp.html" class="external-link">file_temp</a></span><span class="op">(</span>ext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span></span>
<span>  <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>  <span class="op">~</span> <span class="fu"><a href="../reference/plot_raster.html">plot_raster_src</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    band <span class="op">=</span> <span class="va">.x</span>,</span>
<span>    minmax_def <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">.x</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="kw">else</span> <span class="cn">NULL</span>,</span>
<span>    pal <span class="op">=</span> <span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"Inferno"</span><span class="op">)</span>,</span>
<span>    legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    axes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/derived-bands-1.png" width="50%"><img src="figure/derived-bands-2.png" width="50%"><img src="figure/derived-bands-3.png" width="50%"><img src="figure/derived-bands-4.png" width="50%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hugh Graham.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
